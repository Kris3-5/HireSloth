<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HireSloth Admin Panel</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; background: #FCEFDC; color: #3C3525; margin: 0; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: #FFFFFF; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 0; }
    header h1 { margin: 0; font-size: 1.5rem; }
    header button { padding: 0.5rem 1rem; cursor: pointer; background: #A18F7B; color: #FCEFDC; border: none; border-radius: 4px; }
    .content { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
    .jobs { display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem; }
    .job-card { background: #FFF8F2; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); position: relative; display: flex; flex-direction: column; }
    .job-card.recent { border-left: 6px solid #4CAF50; }
    .status-badge { position: absolute; top: 1rem; right: 1rem; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.8rem; font-weight: bold; color: #FFF; }
    .status-pending { background: #FF9800; }
    .status-approved { background: #4CAF50; }
    .job-card h3 { margin: 0 0 0.5rem 0; }
    .job-card p { margin: 0.3rem 0; }
    .job-card button { margin-top: 0.5rem; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .approve-btn { background: #4CAF50; color: #FFF; margin-right: 0.5rem; }
    .approve-btn:hover { background: #388E3C; }
    .delete-btn { background: #F44336; color: #FFF; }
    .delete-btn:hover { background: #C62828; }
    .bulk-actions { margin: 1rem 0; display: flex; gap: 1rem; align-items: center; }
    .bulk-actions button { padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .bulk-approve { background: #4CAF50; color: #FFF; }
    .bulk-delete { background: #F44336; color: #FFF; }
  </style>
</head>
<body>
  <header>
    <h1>HireSloth Admin Panel</h1>
    <button id="logoutBtn">Log Out</button>
  </header>

  <div class="content">
    <h2>Pending / Active Job Posts</h2>

    <div class="bulk-actions">
      <button id="bulkApprove" class="bulk-approve">Approve Selected ✅</button>
      <button id="bulkDelete" class="bulk-delete">Delete Selected ❌</button>
      <input type="text" id="searchInput" placeholder="Search jobs by title or company">
    </div>

    <div class="jobs" id="jobsContainer"></div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://arzddicguiydfvtwewlq.supabase.co";  // replace
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyemRkaWNndWl5ZGZ2dHdld2xxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzA5NDcsImV4cCI6MjA3MzAwNjk0N30.UjZj0XeB8BtjSDsFyf9swxHA26OniI1Mk1ddgSTUXYg";  // replace
    const supabase = createClient(supabaseUrl, supabaseKey);

    const jobsContainer = document.getElementById("jobsContainer");
    const logoutBtn = document.getElementById("logoutBtn");
    const bulkApproveBtn = document.getElementById("bulkApprove");
    const bulkDeleteBtn = document.getElementById("bulkDelete");
    const searchInput = document.getElementById("searchInput");

    let jobsData = [];

    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });

    // Load jobs from Supabase
    async function loadJobs() {
      const { data, error } = await supabase
        .from("jobs")
        .select("*")
        .order("created_at", { ascending: false });

      if (error) {
        jobsContainer.innerHTML = "<p>❌ Error loading jobs.</p>";
        console.error(error);
        return;
      }

      jobsData = data;
      renderJobs();
    }

    function renderJobs() {
      const searchTerm = searchInput.value.toLowerCase();
      const filtered = jobsData.filter(job =>
        job.title.toLowerCase().includes(searchTerm) ||
        job.company.toLowerCase().includes(searchTerm)
      );

      if (!filtered.length) {
        jobsContainer.innerHTML = "<p>No jobs found.</p>";
        return;
      }

      jobsContainer.innerHTML = filtered.map(job => {
        const isRecent = new Date() - new Date(job.created_at) < 24 * 60 * 60 * 1000;
        const statusClass = job.approved ? "status-approved" : "status-pending";
        const statusText = job.approved ? "Approved" : "Pending";

        return `
          <div class="job-card ${isRecent ? 'recent' : ''}">
            <input type="checkbox" class="select-job" data-id="${job.id}">
            <span class="status-badge ${statusClass}">${statusText}</span>
            <h3>${job.title}</h3>
            <p><strong>Company:</strong> ${job.company}</p>
            <p><strong>Location:</strong> ${job.location || 'N/A'} ${job.remote ? '(Remote)' : ''}</p>
            <p><strong>Salary:</strong> ${job.salary || 'N/A'}</p>
            <p><strong>Description:</strong> ${job.description}</p>
            <p><strong>Responsibilities:</strong> ${job.responsibilities || 'N/A'}</p>
            ${!job.approved ? `<button class="approve-btn" onclick="approveJob('${job.id}')">Approve ✅</button>` : ''}
            <button class="delete-btn" onclick="deleteJob('${job.id}')">Delete ❌</button>
          </div>
        `;
      }).join('');
    }

    window.approveJob = async function(id) {
      await supabase.from("jobs").update({ approved: true }).eq("id", id);
      loadJobs();
    };

    window.deleteJob = async function(id) {
      if (!confirm("Are you sure you want to delete this job?")) return;
      await supabase.from("jobs").delete().eq("id", id);
      loadJobs();
    };

    // Bulk approve
    bulkApproveBtn.addEventListener("click", async () => {
      const selected = Array.from(document.querySelectorAll(".select-job:checked")).map(cb => cb.dataset.id);
      if (!selected.length) return alert("Select jobs to approve.");
      await supabase.from("jobs").update({ approved: true }).in("id", selected);
      loadJobs();
    });

    // Bulk delete
    bulkDeleteBtn.addEventListener("click", async () => {
      const selected = Array.from(document.querySelectorAll(".select-job:checked")).map(cb => cb.dataset.id);
      if (!selected.length) return alert("Select jobs to delete.");
      if (!confirm(`Delete ${selected.length} selected job(s)?`)) return;
      await supabase.from("jobs").delete().in("id", selected);
      loadJobs();
    });

    // Search functionality
    searchInput.addEventListener("input", renderJobs);

    loadJobs();
  </script>
</body>
</html>
